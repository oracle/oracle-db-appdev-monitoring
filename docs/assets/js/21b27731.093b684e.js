"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[798],{3791:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"advanced/txeventq","title":"Monitoring TxEventQ","description":"Oracle Transactional Event Queues (\\"TxEventQ\\") is a fault-tolerant, scalable, real-time messaging backbone offered by converged Oracle Database that allows you to build an enterprise-class event-driven architectures.","source":"@site/docs/advanced/txeventq.md","sourceDirName":"advanced","slug":"/advanced/txeventq","permalink":"/oracle-db-appdev-monitoring/docs/advanced/txeventq","draft":false,"unlisted":false,"editUrl":"https://github.com/oracle/oracle-db-appdev-monitoring/tree/main/site/docs/advanced/txeventq.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Monitoring TxEventQ","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Configuring the Go Runtime","permalink":"/oracle-db-appdev-monitoring/docs/advanced/go-runtime"},"next":{"title":"Development","permalink":"/oracle-db-appdev-monitoring/docs/advanced/development"}}');var s=n(4848),o=n(8453);const r={title:"Monitoring TxEventQ",sidebar_position:2},i="Monitoring Transactional Event Queues",c={},d=[{value:"How to create some traffic with PL/SQL",id:"how-to-create-some-traffic-with-plsql",level:3},{value:"How to create some traffic with Java (Spring Boot)",id:"how-to-create-some-traffic-with-java-spring-boot",level:3},{value:"Metrics definitions",id:"metrics-definitions",level:3},{value:"Additional database permissions",id:"additional-database-permissions",level:3},{value:"Grafana dashboard",id:"grafana-dashboard",level:3}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h3:"h3",header:"header",img:"img",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"monitoring-transactional-event-queues",children:"Monitoring Transactional Event Queues"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.a,{href:"https://docs.oracle.com/en/database/oracle/oracle-database/23/adque/index.html",children:"Oracle Transactional Event Queues"}),' ("TxEventQ") is a fault-tolerant, scalable, real-time messaging backbone offered by converged Oracle Database that allows you to build an enterprise-class event-driven architectures.']}),"\n",(0,s.jsx)(t.p,{children:"Access to the real-time broker, producer, and consumer metrics in a single dashboard and receiving alerts for issues allows teams to understand the state of their system."}),"\n",(0,s.jsx)(t.p,{children:"The exporter includes a set of metrics for monitoring TxEventQ and a pre-built Grafana dashboard."}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"Note: The metrics are written for Oracle Database 21c or later."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"how-to-create-some-traffic-with-plsql",children:"How to create some traffic with PL/SQL"}),"\n",(0,s.jsx)(t.p,{children:"If you need to create a topic to monitor, you can use these statements to create and start a topic, and create a subscriber:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"declare\n    subscriber sys.aq$_agent;\nbegin\n  -- create the topic\n  dbms_aqadm.create_transactional_event_queue(\n    queue_name => 'my_topic',\n    multiple_consumers => true  -- true makes a pub/sub topic\n  );\n\n  -- start the topic\n  dbms_aqadm.start_queue(\n    queue_name => 'my_topic'\n  );\n\n  -- create a subscriber\n  dbms_aqadm.add_subscriber(\n    queue_name => 'my_teq',\n    subscriber => sys.aq$_agent(\n      'my_subscriber',    -- the subscriber name\n      null,               -- address, only used for notifications\n      0                   -- protocol\n    ),\n    rule => 'correlation = ''my_subscriber'''\n  );\nend;\n"})}),"\n",(0,s.jsx)(t.p,{children:"You can produce a message with these commands:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"declare\n    enqueue_options    dbms_aq.enqueue_options_t;\n    message_properties dbms_aq.message_properties_t;\n    message_handle     raw(16);\n    message            SYS.AQ$_JMS_TEXT_MESSAGE;\nbegin\n    -- create the message payload\n    message := SYS.AQ$_JMS_TEXT_MESSAGE.construct;\n    message.set_text('{\"orderid\": 12345, \"username\": \"Jessica Smith\"}');\n\n    -- set the consumer name\n    message_properties.correlation := 'my_subscriber';\n\n    -- enqueue the message\n    dbms_aq.enqueue(\n        queue_name           => 'my_topic',\n        enqueue_options      => enqueue_options,\n        message_properties   => message_properties,\n        payload              => message,\n        msgid                => message_handle);\n\n    -- commit the transaction\n    commit;\nend;\n"})}),"\n",(0,s.jsx)(t.h3,{id:"how-to-create-some-traffic-with-java-spring-boot",children:"How to create some traffic with Java (Spring Boot)"}),"\n",(0,s.jsxs)(t.p,{children:["A simple load generator is provided in ",(0,s.jsx)(t.a,{href:"https://github.com/oracle/oracle-db-appdev-monitoring/tree/main/docker-compose/txeventq-load",children:"this directory"})," which you can use to create some traffic so you can experiment with the sample dashboard."]}),"\n",(0,s.jsxs)(t.p,{children:["To run the sample, first update ",(0,s.jsx)(t.a,{href:"https://github.com/oracle/oracle-db-appdev-monitoring/blob/main/docker-compose/txeventq-load/src/main/resources/application.yaml",children:"application.yaml"})," with the correct IP address for your database, then start the application as follows:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mvn spring-boot:run\n"})}),"\n",(0,s.jsx)(t.p,{children:"The application will create ten queues names TOPIC_0 through TOPIC_9 and randomly produce and consume messages on those queues.  The example dashboard shown below was monitoring traffic produced using this application."}),"\n",(0,s.jsx)(t.h3,{id:"metrics-definitions",children:"Metrics definitions"}),"\n",(0,s.jsxs)(t.p,{children:["The metrics definitions are provided in ",(0,s.jsx)(t.a,{href:"https://github.com/oracle/oracle-db-appdev-monitoring/blob/main/custom-metrics-example/txeventq-metrics.toml",children:"this file"}),".  You need to provide this file to the exporter, e.g., by adding it to your container image, or creating a Kubernetes config map containing the file and mounting that config map as a volume in your deployment.  You also need to set the ",(0,s.jsx)(t.code,{children:"CUSTOM_METRICS"})," environment variable to the location of this file."]}),"\n",(0,s.jsx)(t.h3,{id:"additional-database-permissions",children:"Additional database permissions"}),"\n",(0,s.jsx)(t.p,{children:'The database user that the exporter uses to connect to the database will also need additional permissions, which can be granted with these statements.  This example assumes the exporter connects with the username "exporter":'}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-sql",children:"grant execute on dbms_aq to exporter;\ngrant execute on dbms_aqadm to exporter;\ngrant execute on dbms_aqin to exporter;\ngrant execute on dbms_aqjms_internal to exporter;\ngrant execute on dbms_teqk to exporter;\ngrant execute on DBMS_RESOURCE_MANAGER to exporter;\ngrant select_catalog_role to exporter;\ngrant select on sys.aq$_queue_shards to exporter;\ngrant select on user_queue_partition_assignment_table to exporter;\n"})}),"\n",(0,s.jsx)(t.h3,{id:"grafana-dashboard",children:"Grafana dashboard"}),"\n",(0,s.jsxs)(t.p,{children:["A Grafana dashboard for Transactional Event Queues is provided ",(0,s.jsx)(t.a,{href:"https://github.com/oracle/oracle-db-appdev-monitoring/blob/main/docker-compose/grafana/dashboards/txeventq.json",children:"in this file"}),".  This can be imported into your Grafana environment.  Choose the Prometheus datasource that is collecting metrics from the exporter."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"Note:  You may not see any activity on the dashboard unless there are clients producing and consuming messages from topics."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The dashboard will look like this:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Oracle Database Dashboard",src:n(7242).A+"",width:"1893",height:"1487"})})]})}function m(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},7242:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/txeventq-dashboard-v2-880ceab000b0e8c267e0eedf322350d4.png"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>i});var a=n(6540);const s={},o=a.createContext(s);function r(e){const t=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);