"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[9006],{900:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"getting-started/kubernetes","title":"Kubernetes","description":"You can run the exporter in Kubernetes using provided manifests.","source":"@site/versioned_docs/version-2.2.0/getting-started/kubernetes.md","sourceDirName":"getting-started","slug":"/getting-started/kubernetes","permalink":"/oracle-db-appdev-monitoring/docs/getting-started/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/oracle/oracle-db-appdev-monitoring/tree/main/site/versioned_docs/version-2.2.0/getting-started/kubernetes.md","tags":[],"version":"2.2.0","sidebarPosition":3,"frontMatter":{"title":"Kubernetes","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Default Metrics","permalink":"/oracle-db-appdev-monitoring/docs/getting-started/default-metrics"},"next":{"title":"Grafana Dashboards","permalink":"/oracle-db-appdev-monitoring/docs/getting-started/grafana-dashboards"}}');var a=r(4848),o=r(8453);const s={title:"Kubernetes",sidebar_position:3},i="Kubernetes",c={},l=[{value:"Create a secret with credentials for connecting to the Oracle Database",id:"create-a-secret-with-credentials-for-connecting-to-the-oracle-database",level:3},{value:"Create a config map for the exporter configuration file (recommended)",id:"create-a-config-map-for-the-exporter-configuration-file-recommended",level:3},{value:"Create a config map for the wallet (optional)",id:"create-a-config-map-for-the-wallet-optional",level:3},{value:"Create a config map for your metrics definition file (optional)",id:"create-a-config-map-for-your-metrics-definition-file-optional",level:3},{value:"Deploy the Oracle Database Observability exporter",id:"deploy-the-oracle-database-observability-exporter",level:3},{value:"Create a Kubernetes service for the exporter",id:"create-a-kubernetes-service-for-the-exporter",level:3},{value:"Create a Kubernetes service monitor",id:"create-a-kubernetes-service-monitor",level:3},{value:"Configure a Prometheus target (optional)",id:"configure-a-prometheus-target-optional",level:3}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"kubernetes",children:"Kubernetes"})}),"\n",(0,a.jsx)(t.p,{children:"You can run the exporter in Kubernetes using provided manifests."}),"\n",(0,a.jsxs)(t.p,{children:["To run the exporter in Kubernetes, you must complete the following steps.  All steps must be completed in the same Kunernetes namespace.  The examples below assume you want to use a namespace called ",(0,a.jsx)(t.code,{children:"exporter"}),", you must change the commands if you wish to use a different namespace."]}),"\n",(0,a.jsx)(t.h3,{id:"create-a-secret-with-credentials-for-connecting-to-the-oracle-database",children:"Create a secret with credentials for connecting to the Oracle Database"}),"\n",(0,a.jsxs)(t.p,{children:["Create a secret with the Oracle database user and password that the exporter should use to connect to the database using this command.  You must specify the correct user and password for your environment.  This example uses ",(0,a.jsx)(t.code,{children:"pdbadmin"})," as the user and ",(0,a.jsx)(t.code,{children:"Welcome12345"})," as the password:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl create secret generic db-secret \\\n    --from-literal=username=pdbadmin \\\n    --from-literal=password=Welcome12345 \\\n    -n exporter\n"})}),"\n",(0,a.jsx)(t.h3,{id:"create-a-config-map-for-the-exporter-configuration-file-recommended",children:"Create a config map for the exporter configuration file (recommended)"}),"\n",(0,a.jsx)(t.p,{children:"Create a config map with the exporter configuration file (if you are using one) using this command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl create cm metrics-exporter-config \\\n    --from-file=metrics-exporter-config.yaml\n"})}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsx)(t.p,{children:"NOTE: It is strongly recommended to migrate to the new config file if you are running version 2.0.0 or later."}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"create-a-config-map-for-the-wallet-optional",children:"Create a config map for the wallet (optional)"}),"\n",(0,a.jsxs)(t.p,{children:["Create a config map with the wallet (if you are using one) using this command.  Run this command in the ",(0,a.jsx)(t.code,{children:"wallet"})," directory you created earlier."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl create cm db-metrics-tns-admin \\\n    --from-file=cwallet.sso \\\n    --from-file=ewallet.p12 \\\n    --from-file=ewallet.pem \\\n    --from-file=keystore.jks \\\n    --from-file=ojdbc.properties \\\n    --from-file=sqlnet.ora \\\n    --from-file=tnsnames.ora \\\n    --from-file=truststore.jks \\\n    -n exporter\n"})}),"\n",(0,a.jsx)(t.h3,{id:"create-a-config-map-for-your-metrics-definition-file-optional",children:"Create a config map for your metrics definition file (optional)"}),"\n",(0,a.jsxs)(t.p,{children:["If you have defined any ",(0,a.jsx)(t.a,{href:"/oracle-db-appdev-monitoring/docs/configuration/custom-metrics",children:"custom metrics"}),", you must create a config map for the metrics definition file.  For example, if you created a configuration file called ",(0,a.jsx)(t.code,{children:"txeventq-metrics.toml"}),", then create the config map with this command:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl create cm db-metrics-txeventq-exporter-config \\\n    --from-file=txeventq-metrics.toml \\\n    -n exporter\n"})}),"\n",(0,a.jsx)(t.h3,{id:"deploy-the-oracle-database-observability-exporter",children:"Deploy the Oracle Database Observability exporter"}),"\n",(0,a.jsxs)(t.p,{children:["A sample Kubernetes manifest is provided ",(0,a.jsx)(t.a,{href:"https://github.com/oracle/oracle-db-appdev-monitoring/blob/main/kubernetes/metrics-exporter-deployment.yaml",children:"here"}),".  You must edit this file to set the namespace you wish to use, the database connect string to use, and if you have any custom metrics, you will need to uncomment and customize some sections in this file."]}),"\n",(0,a.jsx)(t.p,{children:"Once you have made the necessary updates, apply the file to your cluster using this command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f metrics-exporter-deployment.yaml\n"})}),"\n",(0,a.jsx)(t.p,{children:"You can check the deployment was successful and monitor the exporter startup with this command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl get pods -n exporter -w\n"})}),"\n",(0,a.jsx)(t.p,{children:"You can view the exporter's logs with this command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl logs -f svc/metrics-exporter -n exporter\n"})}),"\n",(0,a.jsx)(t.h3,{id:"create-a-kubernetes-service-for-the-exporter",children:"Create a Kubernetes service for the exporter"}),"\n",(0,a.jsxs)(t.p,{children:["Create a Kubernetes service to allow access to the exporter pod(s).  A sample Kubernetes manifest is provided ",(0,a.jsx)(t.a,{href:"https://github.com/oracle/oracle-db-appdev-monitoring/blob/main/kubernetes/metrics-exporter-service.yaml",children:"here"}),".  You may need to customize this file to update the namespace."]}),"\n",(0,a.jsx)(t.p,{children:"Once you have made any necessary udpates, apply the file to your cluster using this command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f metrics-exporter-service.yaml\n"})}),"\n",(0,a.jsx)(t.h3,{id:"create-a-kubernetes-service-monitor",children:"Create a Kubernetes service monitor"}),"\n",(0,a.jsxs)(t.p,{children:["Create a Kubernetes service monitor to tell Prometheus (for example) to collect metrics from the exporter.  A sample Kubernetes manifest is provided ",(0,a.jsx)(t.a,{href:"https://github.com/oracle/oracle-db-appdev-monitoring/blob/main/kubernetes/metrics-service-monitor.yaml",children:"here"}),".  You may need to customize this file to update the namespace."]}),"\n",(0,a.jsx)(t.p,{children:"Once you have made any necessary udpates, apply the file to your cluster using this command:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f metrics-service-monitor.yaml\n"})}),"\n",(0,a.jsx)(t.h3,{id:"configure-a-prometheus-target-optional",children:"Configure a Prometheus target (optional)"}),"\n",(0,a.jsx)(t.p,{children:"You may need to update your Prometheus configuration to add a target.  If so, you can use this example job definition as a guide:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"  - job_name: 'oracle-exporter'\n    metrics_path: '/metrics'\n    scrape_interval: 15s\n    scrape_timeout: 10s\n    static_configs:\n    - targets: \n      - metrics-exporter.exporter.svc.cluster.local:9161\n"})})]})}function m(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>i});var n=r(6540);const a={},o=n.createContext(a);function s(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);